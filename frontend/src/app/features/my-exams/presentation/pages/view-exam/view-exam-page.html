<section class="view-exam-page">
  <app-loading *ngIf="isLoading" />

  <ng-container *ngIf="!isLoading">
    <div class="exam-header">
      <h2 class="view-exam-title">{{ exam.title | capitalize }}</h2>
      <span class="exam-type-chip">{{ getExamTypeName(exam.type) }}</span>
    </div>

    <div class="exam-details">
      <div class="exam-info">
        <p>
          <strong>Data do exame:</strong>
          {{ exam.date | date: 'dd/MM/yyyy' }}
        </p>
        <p *ngIf="exam.description">
          <strong>Descrição:</strong>
          {{ exam.description }}
        </p>
        <p *ngIf="exam.result">
          <strong>Resultado:</strong>
          {{ exam.result }}
        </p>
        <p *ngIf="exam.notes">
          <strong>Notas:</strong>
          {{ exam.notes }}
        </p>
      </div>

      <div class="exam-file-viewer" *ngIf="exam.fileContent">
        <h3>Arquivo do exame</h3>
        <ng-container *ngIf="exam.fileContent">
          <iframe
            [src]="'data:application/pdf;base64,' + exam.fileContent"
            width="100%"
            height="600px"
            style="border: 1px solid #ccc; border-radius: 8px"
          ></iframe>
        </ng-container>
        <ng-container *ngIf="!exam.fileContent">
          <p>Arquivo não disponível.</p>
        </ng-container>
      </div>
    </div>

    <div class="exam-actions">
      <button
        mat-raised-button
        color="primary"
        (click)="editExam()"
        class="edit-exam-button"
        [disabled]="isLoading"
      >
        Editar Exame
      </button>
      <button
        mat-raised-button
        color="warn"
        (click)="deleteExam()"
        class="delete-exam-button"
        [disabled]="isLoading"
      >
        Excluir Exame
      </button>
    </div>
  </ng-container>

  <app-modal
    *ngIf="showConfirmDeleteExamModal"
    [title]="'Deletar exame'"
    [message]="'Você tem certeza que deseja excluir este exame?'"
    [ctaText]="'Excluir'"
    (ctaAction)="confirmDelete()"
    (close)="closeDeleteModal()"
  ></app-modal>
</section>
