<h1 align="center">ü©∫ iData Backend</h1>

<p align="center">
  API RESTful segura para gerenciamento de dados cl√≠nicos e pessoais, com autentica√ß√£o em dois fatores (2FA) e containeriza√ß√£o com Docker.
</p>

<hr>

<h2>üöÄ Vis√£o Geral</h2>

<p>
O <strong>iData Backend</strong> √© uma aplica√ß√£o desenvolvida em <code>Java 17</code> com <code>Spring Boot</code>, conectada a um banco NoSQL <code>MongoDB</code> e com mapeamento via <code>MapStruct</code>. Suporta autentica√ß√£o 2FA por e-mail e foi projetada para execu√ß√£o consistente em ambientes Docker.
</p>

<h2>üß© Funcionalidades</h2>

<ul>
  <li><strong>Cadastro de usu√°rios pessoais</strong> com dados b√°sicos e endere√ßo</li>
  <li><strong>Cadastro de profissionais da sa√∫de</strong> com valida√ß√£o de licen√ßa (CRM, CRO, etc.)</li>
  <li><strong>Login com autentica√ß√£o em dois fatores (2FA)</strong> via e-mail</li>
  <li><strong>Consulta por CPF</strong> para usu√°rios pessoais e profissionais</li>
  <li><strong>Atualiza√ß√£o de informa√ß√µes cadastrais</strong></li>
  <li><strong>Exclus√£o de contas com verifica√ß√£o por e-mail</strong></li>
</ul>

<h2>üõ†Ô∏è Tecnologias Utilizadas</h2>

<ul>
  <li>Java 17 (OpenJDK)</li>
  <li>Spring Boot 3.4.4</li>
  <li>MongoDB 6.0</li>
  <li>MapStruct 1.5.5.Final</li>
  <li>Lombok 1.18.32</li>
  <li>Caffeine Cache 3.1.8</li>
  <li>Maven 3.9.9</li>
  <li>Docker & Docker Compose</li>
</ul>

<h2>üìå Endpoints Principais</h2>

<h3>Usu√°rio Pessoal</h3>

<table>
  <thead>
    <tr>
      <th>A√ß√£o</th>
      <th>M√©todo</th>
      <th>Endpoint</th>
      <th>Descri√ß√£o</th>
    </tr>
  </thead>
  <tbody>
    <tr><td>Cadastro</td><td>POST</td><td>/api/user/register?type=personal</td><td>Registra usu√°rio pessoal</td></tr>
    <tr><td>Login</td><td>POST</td><td>/api/user/login?type=personal</td><td>Inicia login</td></tr>
    <tr><td>Verifica√ß√£o 2FA</td><td>POST</td><td>/api/user/verify-2fa?type=personal</td><td>Confirma login</td></tr>
    <tr><td>Consulta</td><td>GET</td><td>/api/user?type=personal</td><td>Busca dados por CPF</td></tr>
    <tr><td>Atualiza√ß√£o</td><td>PUT</td><td>/api/user?type=personal</td><td>Atualiza dados</td></tr>
    <tr><td>Iniciar Exclus√£o</td><td>DELETE</td><td>/api/user?type=personal</td><td>Solicita exclus√£o</td></tr>
    <tr><td>Confirmar Exclus√£o</td><td>POST</td><td>/api/user/confirm-delete?type=personal</td><td>Confirma com c√≥digo</td></tr>
  </tbody>
</table>

<h3>Usu√°rio Profissional</h3>

<table>
  <thead>
    <tr>
      <th>A√ß√£o</th>
      <th>M√©todo</th>
      <th>Endpoint</th>
      <th>Descri√ß√£o</th>
    </tr>
  </thead>
  <tbody>
    <tr><td>Cadastro</td><td>POST</td><td>/api/user/register?type=professional</td><td>Registra profissional</td></tr>
    <tr><td>Login</td><td>POST</td><td>/api/user/login?type=professional</td><td>Inicia login</td></tr>
    <tr><td>Verifica√ß√£o 2FA</td><td>POST</td><td>/api/user/verify-2fa?type=professional</td><td>Confirma login</td></tr>
    <tr><td>Consulta</td><td>GET</td><td>/api/user?type=professional</td><td>Busca dados por CPF</td></tr>
    <tr><td>Atualiza√ß√£o</td><td>PUT</td><td>/api/user?type=professional</td><td>Atualiza dados</td></tr>
    <tr><td>Iniciar Exclus√£o</td><td>DELETE</td><td>/api/user?type=professional</td><td>Solicita exclus√£o</td></tr>
    <tr><td>Confirmar Exclus√£o</td><td>POST</td><td>/api/user/confirm-delete?type=professional</td><td>Confirma com c√≥digo</td></tr>
  </tbody>
</table>

<h2>üì¶ Como Executar</h2>

<h3>üîß Pr√©-requisitos</h3>

<ul>
  <li>Docker e Docker Compose</li>
  <li>Git</li>
  <li>(Opcional) Java 17, Maven 3.9.9, MongoDB 6.0</li>
  <li>Cliente HTTP (Postman, Insomnia...)</li>
</ul>

<h3>üê≥ Com Docker</h3>

<pre>
git clone https://github.com/vicabats/iData.git
cd iData

docker compose pull
docker compose up -d
</pre>

<p>‚ñ∂Ô∏è Acesse: <code>http://localhost:8080/actuator/health</code></p>

<h3>üíª Execu√ß√£o Local (sem Docker)</h3>

<pre>
mongod  # Iniciar MongoDB local

cd backend/idata
mvn clean install
mvn spring-boot:run -Dspring-boot.run.profiles=dev
</pre>

<p>‚ñ∂Ô∏è Acesse: <code>http://localhost:8080</code></p>

<h2>üì¨ Exemplos de Requisi√ß√£o</h2>

<h4>üìÑ Cadastro Profissional</h4>

<pre>
POST http://localhost:8080/api/user/register?type=professional
Content-Type: application/json

{
  "name": "Juliana Haddad",
  "cpf": "45634572858",
  "email": "juliana.haddad@gmail.com",
  "password": "Juliana12345&",
  "phone": "11912345678",
  "birthdate": "15/09/1987",
  "professionalLicense": "CRM 123456 SP",
  "address": {
    "street": "Rua Exemplo",
    "number": "123",
    "complement": "Apto 45",
    "neighborhood": "Centro",
    "zipCode": "12345-678",
    "city": "S√£o Paulo",
    "state": "SP"
  }
}
</pre>

<p><strong>Resposta:</strong> <code>Profissional registrado com sucesso: 45634572858</code></p>

<h4>üîê Login com 2FA</h4>

<pre>
POST http://localhost:8080/api/user/login?type=personal
Content-Type: application/json

{
  "cpf": "42089736856",
  "password": "Jose12345&"
}
</pre>

<p><strong>Resposta:</strong> <code>C√≥digo de verifica√ß√£o enviado para jose.nascimento@gmail.com</code></p>

<pre>
POST http://localhost:8080/api/user/verify-2fa?type=personal
Content-Type: application/json

{
  "email": "jose.nascimento@gmail.com",
  "code": "123456"
}
</pre>

<p><strong>Resposta:</strong> <code>Login realizado com sucesso</code></p>

<h2>üß™ Solu√ß√£o de Problemas</h2>

<h4>üîª Backend DOWN</h4>

<pre>
docker logs idata-1-new-backend-1
</pre>

<p>Verifique erros como <code>MongoSocketOpenException</code> ou <code>Connection refused</code></p>

<pre>
docker exec -it idata-1-new-backend-1 bash
ping mongodb
telnet mongodb 27017
exit
</pre>

<h4>üö´ Portas ocupadas</h4>

<pre>
netstat -aon | findstr :8080
taskkill /PID &lt;PID&gt; /F
</pre>

<h4>üßπ Limpeza de ambiente</h4>

<pre>
docker compose down
docker rm -f $(docker ps -aq)
docker image rm julianahaddad/idata-backend:v4
docker image prune -f
</pre>

<h2>üìé Links</h2>

<ul>
  <li><strong>Reposit√≥rio:</strong> <a href="https://github.com/vicabats/iData">https://github.com/vicabats/iData</a></li>
  <li><strong>Docker Hub:</strong> <a href="https://hub.docker.com/r/julianahaddad/idata-backend">julianahaddad/idata-backend:v4</a></li>
  <li><strong>CI/CD:</strong> <a href="https://github.com/vicabats/iData/actions">GitHub Actions</a></li>
</ul>

<h2>üë• Equipe</h2>

<ul>
  <li><strong>Juliana Haddad</strong></li>
  <li>Pedro Henrique Moreira</li>
  <li>Vit√≥ria Gomes Batistoti de Abreu</li>
</ul>
